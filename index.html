<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV直播源跳转</title>
    <!-- 引入样式库，确保页面美观 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // 配置Tailwind样式（无需修改）
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36D399',
                        danger: '#F87272',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .pulse-animation {
                animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">
    <div class="max-w-md w-full text-center">
        <!-- 加载状态（用户看到的默认页面） -->
        <div id="loadingState" class="flex flex-col items-center">
            <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mb-6"></div>
            <h1 class="text-2xl font-bold mb-2 text-primary">正在获取IPTV直播源</h1>
            <p class="text-gray-400 mb-4">请稍候，3秒后自动跳转至直播链接...</p>
            <div class="w-full bg-gray-700 rounded-full h-2.5 mt-6">
                <div id="progressBar" class="bg-secondary h-2.5 rounded-full w-0 pulse-animation"></div>
            </div>
            <p id="countdown" class="mt-4 text-gray-500">倒计时 <span id="countdownNum">3</span> 秒</p>
        </div>

        <!-- 错误状态（链接失效时显示） -->
        <div id="errorState" class="hidden">
            <div class="text-danger text-5xl mb-6">
                <i class="fa fa-exclamation-circle"></i>
            </div>
            <h1 class="text-2xl font-bold mb-4 text-danger">直播源获取失败</h1>
            <p id="errorMessage" class="text-gray-400 mb-6">无法连接到直播源，请检查链接有效性</p>
            <button id="retryBtn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-all">
                <i class="fa fa-refresh mr-2"></i>重新尝试
            </button>
        </div>

        <!-- 直播源更新时间 -->
        <div class="mt-8 text-xs text-gray-500">
            <p>直播源最后更新: <span id="lastUpdated">-</span></p>
        </div>
    </div>

    <script>
        // 核心配置（无需修改，已适配你的JSON文件路径）
        const JSON_FILE_PATH = 'live-source.json'; // 与JSON文件的相对路径（同目录下无需改）
        const REDIRECT_DELAY = 3000; // 跳转延迟（3秒，符合用户习惯）
        
        // DOM元素（无需修改）
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const errorMessage = document.getElementById('errorMessage');
        const retryBtn = document.getElementById('retryBtn');
        const progressBar = document.getElementById('progressBar');
        const countdownNum = document.getElementById('countdownNum');
        const lastUpdatedEl = document.getElementById('lastUpdated');
        
        let countdown = Math.ceil(REDIRECT_DELAY / 1000); // 倒计时初始值
        
        // 更新进度条和倒计时（无需修改）
        function updateProgress() {
            const progress = 100 - (countdown / (REDIRECT_DELAY / 1000) * 100);
            progressBar.style.width = `${progress}%`;
            countdownNum.textContent = countdown;
            countdown--;
        }
        
        // 读取JSON并跳转（核心逻辑，无需修改）
        function fetchAndRedirect() {
            // 重置页面状态
            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');
            countdown = Math.ceil(REDIRECT_DELAY / 1000);
            progressBar.style.width = '0%';
            
            // 启动进度条动画
            const progressInterval = setInterval(updateProgress, 1000);
            
            // 加载JSON文件中的直播源
            fetch(JSON_FILE_PATH)
                .then(response => {
                    if (!response.ok) throw new Error(`链接加载失败（状态码：${response.status}）`);
                    return response.json();
                })
                .then(data => {
                    clearInterval(progressInterval); // 停止进度条
                    
                    // 显示最后更新时间
                    if (data.lastUpdated) {
                        const date = new Date(data.lastUpdated);
                        lastUpdatedEl.textContent = date.toLocaleString(); // 转为本地时间格式
                    }
                    
                    // 验证直播源有效性
                    if (!data.liveSource || !data.liveSource.startsWith('http')) {
                        throw new Error('直播源链接无效（需以http/https开头）');
                    }
                    if (data.status !== 'active') throw new Error('当前直播源暂不可用');
                    
                    // 延迟跳转（给用户提示时间）
                    setTimeout(() => {
                        window.location.href = data.liveSource; // 跳转到你的IPTV链接
                    }, REDIRECT_DELAY);
                })
                .catch(error => {
                    clearInterval(progressInterval); // 停止进度条
                    loadingState.classList.add('hidden');
                    errorState.classList.remove('hidden');
                    errorMessage.textContent = `错误原因：${error.message}`;
                    console.error('跳转失败详情：', error);
                });
        }
        
        // 重试按钮事件（无需修改）
        retryBtn.addEventListener('click', fetchAndRedirect);
        
        // 页面加载完成后自动执行跳转逻辑（无需修改）
        window.addEventListener('load', fetchAndRedirect);
    </script>
</body>
</html>